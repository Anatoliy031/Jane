<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>–ñ–∞–Ω—É—Å—è, —ç—Ç–æ —Ç–µ–±–µ ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ—Ç–æ–º—É —á—Ç–æ ‚ù§Ô∏è</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --primary:#1a1a2e;--secondary:#16213e;--accent:#e94560;
      --light:#f5f5f5;--gold:#ffd700;--glass:rgba(255,255,255,.06)
    }
    body{
      min-height:100vh;background:radial-gradient(1200px 600px at 50% -10%,
      rgba(255,215,0,.12),transparent 40%),linear-gradient(135deg,#0f0c29,#302b63,#24243e);
      font-family:'Inter',system-ui,-apple-system,sans-serif;color:#fff;overflow-x:hidden;position:relative
    }

    /* ===== Canvas –∏ –∑–≤—ë–∑–¥—ã ===== */
    #fireworksCanvas{position:fixed;inset:0;width:100%;height:100%;z-index:2;pointer-events:auto}
    .stars{position:fixed;inset:0;z-index:1;pointer-events:none}
    .star{position:absolute;background:#fff;border-radius:50%;animation:twinkle 3s infinite}
    @keyframes twinkle{0%,100%{opacity:0;transform:scale(1)}50%{opacity:.9;transform:scale(1.2)}}

    /* ===== –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ===== */
    .container{position:relative;z-index:3;min-height:100svh;display:flex;align-items:center;justify-content:center;padding:18px}
    .card{
      width:min(940px,100%);border-radius:28px;padding:28px 20px 24px;
      background:var(--glass);backdrop-filter:blur(10px);
      border:1px solid rgba(255,255,255,.12);
      box-shadow:0 25px 60px rgba(0,0,0,.35), inset 0 0 40px rgba(255,255,255,.04);
      animation:popin .9s ease forwards;opacity:0;transform:translateY(24px)
    }
    @keyframes popin{to{opacity:1;transform:translateY(0)}}

    /* ===== –ó–∞–≥–æ–ª–æ–≤–æ–∫ ===== */
    .header{text-align:center;margin-bottom:12px}
    .title{
      font-family:'Dancing Script',cursive;
      font-size:clamp(2.1rem,8vw,3.6rem);font-weight:700;letter-spacing:.5px;
      background:linear-gradient(135deg,#ffd700,#fff6a9,#ffd700);
      -webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;
      filter:drop-shadow(0 2px 12px rgba(255,215,0,.35));animation:glow 2.2s ease-in-out infinite alternate
    }
    @keyframes glow{from{filter:drop-shadow(0 2px 10px rgba(255,215,0,.25))}
                    to{filter:drop-shadow(0 2px 20px rgba(255,215,0,.55))}}
    .subtitle{font-size:1.05rem;color:rgba(255,255,255,.9);letter-spacing:.12em}

    /* ===== –°–µ–º–µ–π–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä–∫–∏-–∫–æ–ª—å—Ü–æ ===== */
    .ring{
      margin:14px auto 4px;display:grid;grid-template-columns:repeat(4,1fr);
      gap:12px;max-width:720px;padding:0 6px
    }
    .avatar{
      --size:86px;width:var(--size);height:var(--size);border-radius:50%;margin:0 auto;position:relative;overflow:hidden;
      background:linear-gradient(135deg,#667eea,#764ba2);box-shadow:0 0 28px rgba(102,126,234,.45);
      animation:float 4s ease-in-out infinite
    }
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
    .avatar::before{
      content:"";position:absolute;inset:-2px;border-radius:50%;padding:2px;
      background:conic-gradient(from 0deg,#ffd700,#ff6b6b,#4ecdc4,#ffd700);
      -webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude;
      animation:spin 3.4s linear infinite
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .avatar img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:50%}
    .label{margin-top:6px;text-align:center;font-size:.9rem;font-weight:700}
    .label small{display:block;opacity:.75;font-weight:500;margin-top:2px}

    /* ===== Typewriter-–±–ª–æ–∫ ===== */
    .typewrap{
      margin:16px 0 14px;background:rgba(233,69,96,.10);
      border:1px solid rgba(233,69,96,.35);border-radius:16px;padding:16px;min-height:88px;display:flex;align-items:center;justify-content:center
    }
    .type{font-size:1.1rem;font-weight:700;color:#ff8a8a;text-align:center;text-shadow:0 0 16px rgba(255,138,138,.5)}
    .cursor{display:inline-block;width:2px;height:1.2em;background:#ff8a8a;margin-left:4px;animation:blink 1s infinite;vertical-align:text-bottom}
    @keyframes blink{0%,50%{opacity:1}51%,100%{opacity:0}}
    .wrong{color:#ff4757;text-decoration:line-through;text-decoration-thickness:2px;opacity:.8}

    /* ===== –°–æ–æ–±—â–µ–Ω–∏–µ ===== */
    .bubble{
      background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);
      border-radius:18px;padding:20px 16px;margin:10px 0 8px
    }
    .msg{font-size:1.05rem;line-height:1.7;text-align:center;color:rgba(255,255,255,.96)}
    .emoji{display:inline-block;font-size:1.25em;margin:0 2px;animation:bounce 2s infinite}
    @keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-5px)}60%{transform:translateY(-3px)}}

    .signature{margin-top:16px;text-align:center;font-weight:800;font-size:1.05rem;color:#ffd700;text-shadow:0 0 18px rgba(255,215,0,.5)}

    /* ===== –ö–Ω–æ–ø–∫–∏ ===== */
    .actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:14px}
    .btn{padding:12px 22px;border:none;border-radius:36px;font-size:1rem;font-weight:700;color:#fff;cursor:pointer;transition:.25s;box-shadow:0 10px 24px rgba(0,0,0,.2)}
    .btn:active{transform:translateY(1px)}
    .btn-fw{background:linear-gradient(135deg,#ff6b6b,#ff8787)}
    .btn-fw:hover{box-shadow:0 16px 36px rgba(255,107,107,.38);transform:translateY(-2px)}
    .btn-music{background:linear-gradient(135deg,#4ecdc4,#44a08d)}
    .btn-music:hover{box-shadow:0 16px 36px rgba(78,205,196,.35);transform:translateY(-2px)}

    /* ===== –ù–µ–±–æ–ª—å—à–∞—è –ø–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ ===== */
    .panel{
      position:fixed;right:10px;bottom:10px;z-index:4;background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.15);backdrop-filter:blur(6px);
      border-radius:12px;padding:10px 12px;display:flex;align-items:center;gap:8px
    }
    .panel input{
      width:150px;max-width:42vw;padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.2);
      background:rgba(255,255,255,.06);color:#fff;font-size:.9rem
    }
    .panel small{opacity:.8}

    /* ===== –ê–¥–∞–ø—Ç–∏–≤ ===== */
    @media (max-width:768px){
      .ring{grid-template-columns:repeat(4,1fr);gap:10px}
      .avatar{--size:74px}
      .type{font-size:1.02rem}
      .msg{font-size:1rem}
      .panel input{width:132px}
    }
    @media (max-width:380px){
      .avatar{--size:68px}
      .label{font-size:.85rem}
    }
  </style>
</head>
<body>
  <!-- –ó–≤—ë–∑–¥—ã –∏ —Å–∞–ª—é—Ç -->
  <div class="stars" id="stars"></div>
  <canvas id="fireworksCanvas" aria-hidden="true"></canvas>

  <!-- –ú—É–∑—ã–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é MP.3 –≤ –∫–æ—Ä–Ω–µ). –ú–æ–∂–Ω–æ —Å–º–µ–Ω–∏—Ç—å –≤ –º–∏–Ω–∏-–ø–∞–Ω–µ–ª–∏. -->
  <audio id="bgm" loop preload="auto">
    <source src="./MP.3" type="audio/mpeg">
    <!-- –§–æ–ª–±—ç–∫–∏, –µ—Å–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–µ—à—å: -->
    <source src="./music.mp3" type="audio/mpeg">
    <source src="./music.ogg" type="audio/ogg">
    <source src="./music.m4a" type="audio/mp4">
  </audio>

  <div class="container">
    <main class="card">
      <header class="header">
        <h1 class="title">–ñ–∞–Ω—É—Å—è, –ø—Ä–∏–≤–µ—Ç! ü•∞</h1>
        <p class="subtitle">–ü—Ä–∞–∑–¥–Ω–∏–∫–∞ –Ω–µ—Ç? –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Ä–∞–∑—É–º–µ–Ω–∏–µ! –¢—É—Ç ‚Äî –º–∏–Ω–∏-—Ñ–µ–π–µ—Ä–≤–µ—Ä–∫ —Å—á–∞—Å—Ç—å—è ‚ú®</p>
      </header>

      <!-- –°–µ–º–µ–π–Ω–æ–µ –∫–æ–ª—å—Ü–æ (—Ñ–æ—Ç–æ –∏–∑ –∫–æ—Ä–Ω—è: Jane, Anton, Mimi, Stef) -->
      <section class="ring" id="ring">
        <div>
          <div class="avatar" data-name="Jane"></div>
          <div class="label">–ñ–∞–Ω–Ω–∞<small>(–ñ–∞–Ω—É—Å—è)</small></div>
        </div>
        <div>
          <div class="avatar" data-name="Anton"></div>
          <div class="label">–ê–Ω—Ç–æ–Ω</div>
        </div>
        <div>
          <div class="avatar" data-name="Mimi"></div>
          <div class="label">–ú–∏–ª–∞—à–µ–Ω—å–∫–∞</div>
        </div>
        <div>
          <div class="avatar" data-name="Stef"></div>
          <div class="label">–°—Ç–µ—à–µ–Ω—å–∫–∞</div>
        </div>
      </section>

      <!-- –ü–µ—á–∞—Ç–∞—é—â–∏–π—Å—è –ø—Ä–∏–∫–æ–ª -->
      <section class="typewrap">
        <div class="type">
          <span id="tw"></span><span class="cursor"></span>
        </div>
      </section>

      <section class="bubble">
        <div class="msg">
          <p>–ü—É—Å—Ç—å –¥–µ–Ω—å –±–µ–∑ –ø–æ–≤–æ–¥–∞ —Å—Ç–∞–Ω–µ—Ç –ø–æ–≤–æ–¥–æ–º —É–ª—ã–±–∞—Ç—å—Å—è —à–∏—Ä–µ –æ–±—ã—á–Ω–æ–≥–æ <span class="emoji">üòÑ</span></p>
          <p>–î–æ–º ‚Äî —É—é—Ç–Ω—ã–π, —á–∞–π ‚Äî –≥–æ—Ä—è—á–∏–π, –¥–µ–≤—á–æ–Ω–∫–∏ ‚Äî —Ö–æ—Ö–æ—á—É—Ç, –ê–Ω—Ç–æ–Ω —à—É—Ç–∏—Ç, –∞ —Ç—ã ‚Äî —Å–∏—è–µ—à—å! <span class="emoji">‚ú®</span></p>
          <p>–ú–∏–Ω—É—Ç–∫–∞ –ø–∞—É–∑—ã –¥–ª—è —Å—á–∞—Å—Ç—å—è: –≤–¥–æ—Ö ‚Äî –∏ –ø–æ–Ω–µ—Å–ª–∞—Å—å —Ä–∞–¥–æ—Å—Ç—å –Ω–∞ –ø–æ–≤—Ç–æ—Ä–µ! <span class="emoji">üîÅ</span></p>
        </div>
      </section>

      <div class="signature">–° –ª—é–±–æ–≤—å—é ‚Äî –ê–Ω–∞—Ç–æ–ª–∏–π –∏ –ò—Ä–∏–Ω–∞ üíõ</div>

      <div class="actions">
        <button class="btn btn-fw" id="btnFire">üéÜ –ü—É—Å—Ç–∏—Ç—å —Å–∞–ª—é—Ç</button>
        <button class="btn btn-music" id="btnMusic">üéµ –ú—É–∑—ã–∫–∞</button>
      </div>
    </main>
  </div>

  <!-- –ú–∏–Ω–∏-–ø–∞–Ω–µ–ª—å: –±—ã—Å—Ç—Ä–æ —Å–º–µ–Ω–∏—Ç—å —Ç—Ä–µ–∫ –±–µ–∑ –ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞ -->
  <div class="panel" title="–£–∫–∞–∂–∏ –∏–º—è —Ñ–∞–π–ª–∞ –º—É–∑—ã–∫–∏, –ª–µ–∂–∞—â–µ–≥–æ –≤ –∫–æ—Ä–Ω–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, MP.3)">
    <small>–¢—Ä–µ–∫:</small>
    <input id="musicName" placeholder="MP.3" value="MP.3" />
    <button class="btn btn-music" id="applyMusic" style="padding:8px 14px;font-size:.9rem">OK</button>
  </div>

<script>
/* =================== –ó–í–Å–ó–î–´ =================== */
(() => {
  const stars = document.getElementById('stars');
  const N = 110;
  for (let i=0;i<N;i++){
    const s=document.createElement('div'); s.className='star';
    const size = Math.random()*2.4+0.6;
    s.style.width=s.style.height=size+'px';
    s.style.left=Math.random()*100+'%';
    s.style.top=Math.random()*100+'%';
    s.style.animationDelay=(Math.random()*3)+'s';
    s.style.animationDuration=(2.2+Math.random()*3.5)+'s';
    stars.appendChild(s);
  }
})();

/* =================== –ó–ê–ì–†–£–ó–ö–ê –§–û–¢–û (Jane/Anton/Mimi/Stef) =================== */
(function loadAvatars(){
  const exts = ['.jpg','.JPG','.jpeg','.JPEG','.png','.PNG','.webp','.WEBP'];
  document.querySelectorAll('.avatar').forEach(box=>{
    const base = './'+box.dataset.name;
    const tryNext = (i=0)=>{
      if(i>=exts.length){ // –§–æ–ª–±—ç–∫ ‚Äî –∏–Ω–∏—Ü–∏–∞–ª—ã
        const name = box.dataset.name || '';
        const initials = (name[0]||'?').toUpperCase();
        const span = document.createElement('span');
        span.textContent=initials;
        span.style.cssText='position:absolute;inset:0;display:grid;place-items:center;font-size:2rem;font-weight:800;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.45)';
        box.appendChild(span);
        return;
      }
      const img=new Image();
      img.onload=()=>{box.appendChild(img)};
      img.onerror=()=>tryNext(i+1);
      img.src=base+exts[i];
    };
    setTimeout(()=>tryNext(0), 60);
  });
})();

/* =================== TYPEWRITER —Å ¬´–æ—à–∏–±–∫–æ–π‚Üí—Å—Ç–∏—Ä–∞–Ω–∏–µ–º¬ª =================== */
(function typewriter(){
  const el = document.getElementById('tw');
  const phrases = [
    ["–°–µ–≥–æ–¥–Ω—è –±—É–¥–µ—Ç ","–æ–±—ã—á–Ω—ã–π","–æ—Å–æ–±–µ–Ω–Ω—ã–π"," –¥–µ–Ω—å ‚Äî –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫! üí´"],
    ["–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ ","—Ç–∞–∫–æ–µ-—Å–µ–±–µ","–æ–≥–Ω–µ–Ω–Ω–æ–µ"," ‚Äî –∞–ø! üöÄ"],
    ["–ü–ª–∞–Ω—ã ","–æ—Ç–ª–æ–∂–∏—Ç—å","–æ–±–Ω—è—Ç—å"," –∏ —É–ª—ã–±–Ω—É—Ç—å—Å—è. ü§ó"],
    ["–ü–æ–≤–æ–¥ ","–Ω–µ –Ω—É–∂–µ–Ω","–Ω–∞–π–¥—ë–Ω",": –ñ–∞–Ω—É—Å—è ‚Äî —Ç—ã –ø—Ä–∏—á–∏–Ω–∞ —Ä–∞–¥–æ—Å—Ç–∏! ‚ú®"]
  ];
  const typeDelay=56, eraseDelay=38, pauseBeforeErase=750, pauseAfter=1300;

  const sleep = ms=>new Promise(r=>setTimeout(r,ms));
  async function typeText(text, from=0){for(let i=from;i<text.length;i++){el.textContent=text.slice(0,i+1);await sleep(typeDelay)}}
  function markWrong(prefix, wrong){el.innerHTML=`${prefix}<span class="wrong" id="wrong">${wrong}</span>`}
  async function eraseWrong(){
    const w=document.getElementById('wrong'); if(!w) return;
    let t=w.textContent;
    while(t.length){t=t.slice(0,-1); w.textContent=t; await sleep(eraseDelay)}
    w.remove();
  }
  async function show([pre, bad, good, suf]){
    el.textContent='';
    await typeText(pre+bad);
    await sleep(pauseBeforeErase);
    markWrong(pre,bad);
    await sleep(280);
    await eraseWrong();
    await typeText(pre+good);
    await typeText(pre+good+suf, (pre+good).length);
    await sleep(pauseAfter);
  }
  (async()=>{let i=0; for(;;){await show(phrases[i++%phrases.length])}})();
})();

/* =================== –°–ê–õ–Æ–¢ (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–µ–µ, –≤—ã—à–µ) + –∑–≤—É–∫ + –≤–∏–±—Ä–∞—Ü–∏—è =================== */
const canvas=document.getElementById('fireworksCanvas');
const ctx=canvas.getContext('2d',{alpha:true});
let fireworks=[], particles=[];
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
resize(); addEventListener('resize',resize);

// WebAudio ¬´—Ö–ª–æ–ø–∫–∏¬ª
let audioCtx=null;
function boomSound(){
  try{
    if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
    const o=audioCtx.createOscillator();
    const g=audioCtx.createGain();
    o.type='triangle';
    o.frequency.setValueAtTime(240,audioCtx.currentTime);
    o.frequency.exponentialRampToValueAtTime(40,audioCtx.currentTime+0.25);
    g.gain.setValueAtTime(0.001,audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.5,audioCtx.currentTime+0.02);
    g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+0.35);
    o.connect(g).connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.36);
  }catch(e){}
}

// –í–∏–±—Ä–∞—Ü–∏—è
function vib(pattern=[25,30,20]){ if(navigator.vibrate) navigator.vibrate(pattern) }

class Particle{
  constructor(x,y,color,vx,vy,size=2){
    this.x=x;this.y=y;this.c=color;this.vx=vx;this.vy=vy;this.s=size;
    this.o=1;this.d=0.012+Math.random()*0.018;this.g=0.06;this.f=Math.random()*.002+.001
  }
  update(){
    // –ª—ë–≥–∫–æ–µ ¬´–¥—É—Ç—å—ë¬ª –≤–µ—Ç—Ä–∞
    this.vx+= (Math.random()-.5)*0.02;
    this.x+=this.vx; this.y+=this.vy; this.vy+=this.g; this.vx*=0.995;
    this.o-=this.d; this.s*=0.997
  }
  draw(){
    ctx.save(); ctx.globalAlpha=Math.max(this.o,0);
    const grd=ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,Math.max(this.s*3,1));
    grd.addColorStop(0,'#fff'); grd.addColorStop(.2,this.c); grd.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=grd; ctx.beginPath(); ctx.arc(this.x,this.y,this.s*2.2,0,Math.PI*2); ctx.fill(); ctx.restore();
  }
}

class Firework{
  constructor(sx,sy,tx,ty,hue=~~(Math.random()*360)){
    this.x=sx; this.y=sy; this.tx=tx; this.ty=ty; this.h=hue;
    this.angle=Math.atan2(ty-sy,tx-sx); this.speed=2.2; this.acc=1.05;
    this.dist=Math.hypot(tx-sx,ty-sy); this.traveled=0; this.trail=[]; this.len=10
  }
  update(i){
    this.trail.push({x:this.x,y:this.y}); if(this.trail.length>this.len) this.trail.shift();
    this.speed*=this.acc; const vx=Math.cos(this.angle)*this.speed, vy=Math.sin(this.angle)*this.speed;
    this.traveled=Math.hypot(this.x+vx-this.tx, this.y+vy-this.ty);
    if(this.traveled<=2 || Math.hypot(this.x-this.tx,this.y-this.ty)<18){
      explode(this.tx,this.ty,this.h); fireworks.splice(i,1); return;
    }
    this.x+=vx; this.y+=vy;
  }
  draw(){
    ctx.save(); ctx.strokeStyle=`hsl(${this.h},100%,60%)`; ctx.lineWidth=2;
    ctx.beginPath(); for(let i=0;i<this.trail.length;i++){
      const p=this.trail[i]; if(i===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y);
    } ctx.stroke(); ctx.restore();
    ctx.save(); ctx.fillStyle=`hsl(${this.h},100%,60%)`; ctx.shadowBlur=18; ctx.shadowColor=`hsl(${this.h},100%,60%)`;
    ctx.beginPath(); ctx.arc(this.x,this.y,2.6,0,Math.PI*2); ctx.fill(); ctx.restore();
  }
}

function explode(x,y,h){
  // —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —Ä–∞–∑—Ä—ã–≤–æ–≤
  const kind = Math.random();
  const n = 90 + (Math.random()*50)|0;
  const base = Math.random()*2.5+1.8;
  for(let i=0;i<n;i++){
    const a = (Math.PI*2/n)*i + (Math.random()*0.1);
    const sp = base + Math.random()*2.5;
    let vx = Math.cos(a)*sp, vy=Math.sin(a)*sp;
    if(kind<.3){ // –∫–æ–ª—å—Ü–æ
      vy*=0.8;
    } else if(kind<.6){ // —Ö—Ä–∏–∑–∞–Ω—Ç–µ–º–∞
      vx*= (0.7+Math.random()*0.6); vy*= (0.7+Math.random()*0.6);
    } else { // –ø–∞–ª—å–º–∞
      vy*=1.2; if(i%7===0) vy*=1.6;
    }
    const color=`hsl(${h+ (Math.random()*50-25)},100%,${50+Math.random()*18}%)`;
    particles.push(new Particle(x,y,color,vx,vy,1.2+Math.random()*2.2));
  }
  // —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –≤—Å–ø—ã—à–∫–∞
  for(let i=0;i<22;i++){
    const a=Math.random()*Math.PI*2, sp=Math.random()*2.2;
    particles.push(new Particle(x,y,'#ffffff',Math.cos(a)*sp,Math.sin(a)*sp,1+Math.random()*1.6));
  }
  boomSound(); vib();
}

function animate(){
  // –¥–µ–ª–∞–µ–º –≤—ã—à–µ/—á–∏—â–µ: –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è ¬´–∑–∞—Ç–∏—Ä–∞—é—â–∞—è¬ª –≤—É–∞–ª—å
  ctx.fillStyle='rgba(0,0,0,.12)'; ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let i=fireworks.length-1;i>=0;i--){fireworks[i].draw(); fireworks[i].update(i)}
  for(let j=particles.length-1;j>=0;j--){
    particles[j].draw(); particles[j].update(); if(particles[j].o<=0) particles.splice(j,1)
  }
  requestAnimationFrame(animate);
}
animate();

// –∞–≤—Ç–æ—Å–∞–ª—é—Ç (—Ä–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ ‚Äî –≤—ã—à–µ —Ü–µ–Ω—Ç—Ä–∞)
setInterval(()=>{
  if(Math.random()<0.055){
    const sx = Math.random()*canvas.width;
    const sy = canvas.height;
    const tx = Math.random()*canvas.width;
    const ty = Math.random()*canvas.height*0.42 + 40; // –≤—ã—à–µ
    fireworks.push(new Firework(sx,sy,tx,ty));
  }
}, 1000);

// –∫–ª–∏–∫ –ø–æ —ç–∫—Ä–∞–Ω—É ‚Äî —Ä—É—á–Ω–æ–π —Å–∞–ª—é—Ç
canvas.addEventListener('click',e=>{
  const tx=e.clientX, ty=e.clientY-20;
  fireworks.push(new Firework(Math.random()*canvas.width, canvas.height, tx, ty));
});

/* =================== –ú–£–ó–´–ö–ê =================== */
let musicOn=false;
const bgm=document.getElementById('bgm');
const btnMusic=document.getElementById('btnMusic');
bgm.volume=0.32;
addEventListener('load',()=>{ bgm.play().then(()=>{musicOn=true;btnMusic.textContent='üîá –í—ã–∫–ª—é—á–∏—Ç—å';}).catch(()=>{}) });
btnMusic.addEventListener('click',()=>{
  if(!musicOn){ bgm.play().then(()=>{musicOn=true;btnMusic.textContent='üîá –í—ã–∫–ª—é—á–∏—Ç—å';btnMusic.classList.add('btn-fw');}); }
  else { bgm.pause(); musicOn=false; btnMusic.textContent='üéµ –ú—É–∑—ã–∫–∞'; btnMusic.classList.remove('btn-fw'); }
});

// –º–∏–Ω–∏-–ø–∞–Ω–µ–ª—å —Å–º–µ–Ω—ã —Ñ–∞–π–ª–∞ (–ª–µ–∂–∏—Ç –≤ –∫–æ—Ä–Ω–µ)
document.getElementById('applyMusic').addEventListener('click',()=>{
  const name = document.getElementById('musicName').value.trim();
  if(!name) return;
  const wasPlaying = !bgm.paused;
  bgm.pause(); musicOn=false;
  bgm.src = './'+name; // –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ
  bgm.load();
  bgm.play().then(()=>{musicOn=true;btnMusic.textContent='üîá –í—ã–∫–ª—é—á–∏—Ç—å';}).catch(()=>{alert('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.');});
});

/* =================== –ö–ù–û–ü–ö–ê –°–ê–õ–Æ–¢–ê =================== */
document.getElementById('btnFire').addEventListener('click',()=>{
  const launches = 9;
  for(let i=0;i<launches;i++){
    setTimeout(()=>{
      const sx=Math.random()*canvas.width, sy=canvas.height;
      const tx=Math.random()*canvas.width, ty=Math.random()*canvas.height*0.38+30;
      fireworks.push(new Firework(sx,sy,tx,ty));
    }, i*180);
  }
  vib([40,30,40]); boomSound();
});

/* =================== –ò–ù–ò–¶: –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø–µ—Ä–≤–æ–π —Å–µ—Ä–∏–∏ =================== */
setTimeout(()=>document.getElementById('btnFire').click(), 1300);
</script>
</body>
</html>
